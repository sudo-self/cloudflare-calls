import{a as st,b as Q}from"/build/_shared/chunk-X4L47D7F.js";import{a as nt}from"/build/_shared/chunk-IXZIAJVT.js";import{b as tt,c as rt}from"/build/_shared/chunk-3VBROEUY.js";import"/build/_shared/chunk-PYJLC5PR.js";import{a as et}from"/build/_shared/chunk-YERPF2QY.js";import{a as g}from"/build/_shared/chunk-6M6UZGDQ.js";import"/build/_shared/chunk-KS76FAJ5.js";import{a as Yt}from"/build/_shared/chunk-45HVJOSI.js";import{d as Xe,e as Ze,k as we}from"/build/_shared/chunk-LQCCCPTH.js";import{a as P,b as H}from"/build/_shared/chunk-3YOPFW4A.js";import{b as Ye,c as K,d as C,f as E,h as v}from"/build/_shared/chunk-5YSEWQXG.js";var Be=Ye((Er,We)=>{"use strict";var d={};d.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)};d.localCName=d.generateIdentifier();d.splitLines=function(e){return e.trim().split(`
`).map(t=>t.trim())};d.splitSections=function(e){return e.split(`
m=`).map((n,r)=>(r>0?"m="+n:n).trim()+`\r
`)};d.getDescription=function(e){let t=d.splitSections(e);return t&&t[0]};d.getMediaSections=function(e){let t=d.splitSections(e);return t.shift(),t};d.matchPrefix=function(e,t){return d.splitLines(e).filter(n=>n.indexOf(t)===0)};d.parseCandidate=function(e){let t;e.indexOf("a=candidate:")===0?t=e.substring(12).split(" "):t=e.substring(10).split(" ");let n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]===void 0&&(n[t[r]]=t[r+1]);break}return n};d.writeCandidate=function(e){let t=[];t.push(e.foundation);let n=e.component;n==="rtp"?t.push(1):n==="rtcp"?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let r=e.type;return t.push("typ"),t.push(r),r!=="host"&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")};d.parseIceOptions=function(e){return e.substring(14).split(" ")};d.parseRtpMap=function(e){let t=e.substring(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=t.length===3?parseInt(t[2],10):1,n.numChannels=n.channels,n};d.writeRtpMap=function(e){let t=e.payloadType;e.preferredPayloadType!==void 0&&(t=e.preferredPayloadType);let n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(n!==1?"/"+n:"")+`\r
`};d.parseExtmap=function(e){let t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}};d.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+`\r
`};d.parseFmtp=function(e){let t={},n,r=e.substring(e.indexOf(" ")+1).split(";");for(let s=0;s<r.length;s++)n=r[s].trim().split("="),t[n[0].trim()]=n[1];return t};d.writeFmtp=function(e){let t="",n=e.payloadType;if(e.preferredPayloadType!==void 0&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let r=[];Object.keys(e.parameters).forEach(s=>{e.parameters[s]!==void 0?r.push(s+"="+e.parameters[s]):r.push(s)}),t+="a=fmtp:"+n+" "+r.join(";")+`\r
`}return t};d.parseRtcpFb=function(e){let t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};d.writeRtcpFb=function(e){let t="",n=e.payloadType;return e.preferredPayloadType!==void 0&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(r=>{t+="a=rtcp-fb:"+n+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),t};d.parseSsrcMedia=function(e){let t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n};d.parseSsrcGroup=function(e){let t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(n=>parseInt(n,10))}};d.getMid=function(e){let t=d.matchPrefix(e,"a=mid:")[0];if(t)return t.substring(6)};d.parseFingerprint=function(e){let t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}};d.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:d.matchPrefix(e+t,"a=fingerprint:").map(d.parseFingerprint)}};d.writeDtlsParameters=function(e,t){let n="a=setup:"+t+`\r
`;return e.fingerprints.forEach(r=>{n+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),n};d.parseCryptoLine=function(e){let t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}};d.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?d.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`};d.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;let t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}};d.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")};d.getCryptoParameters=function(e,t){return d.matchPrefix(e+t,"a=crypto:").map(d.parseCryptoLine)};d.getIceParameters=function(e,t){let n=d.matchPrefix(e+t,"a=ice-ufrag:")[0],r=d.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substring(12),password:r.substring(10)}:null};d.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`;return e.iceLite&&(t+=`a=ice-lite\r
`),t};d.parseRtpParameters=function(e){let t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=d.splitLines(e)[0].split(" ");t.profile=r[2];for(let i=3;i<r.length;i++){let a=r[i],o=d.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){let u=d.parseRtpMap(o),c=d.matchPrefix(e,"a=fmtp:"+a+" ");switch(u.parameters=c.length?d.parseFmtp(c[0]):{},u.rtcpFeedback=d.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(d.parseRtcpFb),t.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(u.name.toUpperCase());break;default:break}}}d.matchPrefix(e,"a=extmap:").forEach(i=>{t.headerExtensions.push(d.parseExtmap(i))});let s=d.matchPrefix(e,"a=rtcp-fb:* ").map(d.parseRtcpFb);return t.codecs.forEach(i=>{s.forEach(a=>{i.rtcpFeedback.find(u=>u.type===a.type&&u.parameter===a.parameter)||i.rtcpFeedback.push(a)})}),t};d.writeRtpDescription=function(e,t){let n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" "+(t.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=t.codecs.map(s=>s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,t.codecs.forEach(s=>{n+=d.writeRtpMap(s),n+=d.writeFmtp(s),n+=d.writeRtcpFb(s)});let r=0;return t.codecs.forEach(s=>{s.maxptime>r&&(r=s.maxptime)}),r>0&&(n+="a=maxptime:"+r+`\r
`),t.headerExtensions&&t.headerExtensions.forEach(s=>{n+=d.writeExtmap(s)}),n};d.parseRtpEncodingParameters=function(e){let t=[],n=d.parseRtpParameters(e),r=n.fecMechanisms.indexOf("RED")!==-1,s=n.fecMechanisms.indexOf("ULPFEC")!==-1,i=d.matchPrefix(e,"a=ssrc:").map(p=>d.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),a=i.length>0&&i[0].ssrc,o,u=d.matchPrefix(e,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(h=>parseInt(h,10)));u.length>0&&u[0].length>1&&u[0][0]===a&&(o=u[0][1]),n.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let m={ssrc:a,codecPayloadType:parseInt(p.parameters.apt,10)};a&&o&&(m.rtx={ssrc:o}),t.push(m),r&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},t.push(m))}}),t.length===0&&a&&t.push({ssrc:a});let c=d.matchPrefix(e,"b=");return c.length&&(c[0].indexOf("b=TIAS:")===0?c=parseInt(c[0].substring(7),10):c[0].indexOf("b=AS:")===0?c=parseInt(c[0].substring(5),10)*1e3*.95-50*40*8:c=void 0,t.forEach(p=>{p.maxBitrate=c})),t};d.parseRtcpParameters=function(e){let t={},n=d.matchPrefix(e,"a=ssrc:").map(i=>d.parseSsrcMedia(i)).filter(i=>i.attribute==="cname")[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);let r=d.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=r.length===0;let s=d.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t};d.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+=`a=rtcp-rsize\r
`),e.mux&&(t+=`a=rtcp-mux\r
`),e.ssrc!==void 0&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+`\r
`),t};d.parseMsid=function(e){let t,n=d.matchPrefix(e,"a=msid:");if(n.length===1)return t=n[0].substring(7).split(" "),{stream:t[0],track:t[1]};let r=d.matchPrefix(e,"a=ssrc:").map(s=>d.parseSsrcMedia(s)).filter(s=>s.attribute==="msid");if(r.length>0)return t=r[0].value.split(" "),{stream:t[0],track:t[1]}};d.parseSctpDescription=function(e){let t=d.parseMLine(e),n=d.matchPrefix(e,"a=max-message-size:"),r;n.length>0&&(r=parseInt(n[0].substring(19),10)),isNaN(r)&&(r=65536);let s=d.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:t.fmt,maxMessageSize:r};let i=d.matchPrefix(e,"a=sctpmap:");if(i.length>0){let a=i[0].substring(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:r}}};d.writeSctpDescription=function(e,t){let n=[];return e.protocol!=="DTLS/SCTP"?n=["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+t.port+`\r
`]:n=["m="+e.kind+" 9 "+e.protocol+" "+t.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+t.port+" "+t.protocol+` 65535\r
`],t.maxMessageSize!==void 0&&n.push("a=max-message-size:"+t.maxMessageSize+`\r
`),n.join("")};d.generateSessionId=function(){return Math.random().toString().substr(2,22)};d.writeSessionBoilerplate=function(e,t,n){let r,s=t!==void 0?t:2;return e?r=e:r=d.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+r+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`};d.getDirection=function(e,t){let n=d.splitLines(e);for(let r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substring(2);default:}return t?d.getDirection(t):"sendrecv"};d.getKind=function(e){return d.splitLines(e)[0].split(" ")[0].substring(2)};d.isRejected=function(e){return e.split(" ",2)[1]==="0"};d.parseMLine=function(e){let n=d.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}};d.parseOLine=function(e){let n=d.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}};d.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;let t=d.splitLines(e);for(let n=0;n<t.length;n++)if(t[n].length<2||t[n].charAt(1)!=="=")return!1;return!0};typeof We=="object"&&(We.exports=d)});var zt=Ye((dn,Gt)=>{Gt.exports={}});var mr=C(Yt());var fe=C(P());var it=C(P());function Xt(){return navigator.onLine}function Zt(){return!0}function wt(e){return window.addEventListener("online",e),window.addEventListener("offline",e),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e)}}function ot(){return(0,it.useSyncExternalStore)(wt,Xt,Zt)}function at(e){return ot()?e.children:e.fallback}var A=C(P());var S=C(H());async function er(){try{return(await navigator.permissions.query({name:"microphone"})).state}catch{return"unable-to-determine"}}function ct(e){let[t,n]=(0,A.useState)(null),r=(0,A.useRef)(!0);return(0,A.useEffect)(()=>(er().then(s=>{r.current&&n(s)}),()=>{r.current=!1}),[]),t===null?null:t==="denied"?(0,S.jsx)("div",{className:"grid items-center h-full",children:(0,S.jsxs)("div",{className:"mx-auto space-y-2 max-w-80",children:[(0,S.jsx)("h1",{className:"text-2xl font-bold",children:"Permission denied"}),(0,S.jsx)("p",{children:"You will need to go into your browser settings and manually re-enable permission."})]})}):t==="prompt"?(0,S.jsx)("div",{className:"grid items-center h-full",children:(0,S.jsxs)("div",{className:"mx-auto max-w-80",children:[(0,S.jsx)("p",{className:"mb-8",children:"In order to use Orange Meets, you will need to grant permission to your camera and microphone. You will be prompted for access."}),(0,S.jsx)(et,{onClick:()=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(s=>{r.current&&n("granted"),s.getTracks().forEach(i=>i.stop())}).catch(()=>{r.current&&n("denied")})},children:"Allow access"})]})}):e.children}var F=C(P());var ut=!0,mt=!0;function z(e,t,n){let r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function T(e,t,n){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(a,o){if(a!==t)return s.apply(this,arguments);let u=c=>{let p=n(c);p&&(o.handleEvent?o.handleEvent(p):o(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(o,u),s.apply(this,[a,u])};let i=r.removeEventListener;r.removeEventListener=function(a,o){if(a!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(o))return i.apply(this,arguments);let u=this._eventMap[t].get(o);return this._eventMap[t].delete(o),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[a,u])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function dt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(ut=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ht(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(mt=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Y(){if(typeof window=="object"){if(ut)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function N(e,t){mt&&console.warn(e+" is deprecated, please use "+t+" instead.")}function lt(e){let t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;let{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){let r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=z(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=z(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=z(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function pt(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ce(e){return pt(e)?Object.keys(e).reduce(function(t,n){let r=pt(e[n]),s=r?Ce(e[n]):e[n],i=r&&!Object.keys(s).length;return s===void 0||i?t:Object.assign(t,{[n]:s})},{}):e}function ye(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?ye(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(s=>{ye(e,e.get(s),n)})}))}function ve(e,t,n){let r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;let i=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&i.push(a)}),i.forEach(a=>{e.forEach(o=>{o.type===r&&o.trackId===a.id&&ye(e,o,s)})}),s}var w={};K(w,{fixNegotiationNeeded:()=>_e,shimAddTrackRemoveTrack:()=>be,shimAddTrackRemoveTrackWithNative:()=>gt,shimGetSendersWithDtmf:()=>Re,shimGetUserMedia:()=>X,shimMediaStream:()=>Se,shimOnTrack:()=>Te,shimPeerConnection:()=>Z,shimSenderReceiverGetStats:()=>Pe});var ft=Y;function X(e,t){let n=e&&e.navigator;if(!n.mediaDevices)return;let r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;let u={};return Object.keys(o).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;let p=typeof o[c]=="object"?o[c]:{ideal:o[c]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);let m=function(h,l){return h?h+l.charAt(0).toUpperCase()+l.slice(1):l==="deviceId"?"sourceId":l};if(p.ideal!==void 0){u.optional=u.optional||[];let h={};typeof p.ideal=="number"?(h[m("min",c)]=p.ideal,u.optional.push(h),h={},h[m("max",c)]=p.ideal,u.optional.push(h)):(h[m("",c)]=p.ideal,u.optional.push(h))}p.exact!==void 0&&typeof p.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[m("",c)]=p.exact):["min","max"].forEach(h=>{p[h]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[m(h,c)]=p[h])})}),o.advanced&&(u.optional=(u.optional||[]).concat(o.advanced)),u},s=function(o,u){if(t.version>=61)return u(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){let c=function(p,m,h){m in p&&!(h in p)&&(p[h]=p[m],delete p[m])};o=JSON.parse(JSON.stringify(o)),c(o.audio,"autoGainControl","googAutoGainControl"),c(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let c=o.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});let p=t.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete o.video.facingMode;let m;if(c.exact==="environment"||c.ideal==="environment"?m=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(f=>f.kind==="videoinput");let l=h.find(f=>m.some(y=>f.label.toLowerCase().includes(y)));return!l&&h.length&&m.includes("back")&&(l=h[h.length-1]),l&&(o.video.deviceId=c.exact?{exact:l.deviceId}:{ideal:l.deviceId}),o.video=r(o.video),ft("chrome: "+JSON.stringify(o)),u(o)})}o.video=r(o.video)}return ft("chrome: "+JSON.stringify(o)),u(o)},i=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(o,u,c){s(o,p=>{n.webkitGetUserMedia(p,u,m=>{c&&c(i(m))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){let o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return s(u,c=>o(c).then(p=>{if(c.audio&&!p.getAudioTracks().length||c.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(i(p))))}}}function Se(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Te(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;e.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(o=>o.track&&o.track.id===s.track.id):i={track:s.track};let a=new Event("track");a.track=s.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[r.stream],this.dispatchEvent(a)}),r.stream.getTracks().forEach(s=>{let i;e.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(o=>o.track&&o.track.id===s.id):i={track:s};let a=new Event("track");a.track=s,a.receiver=i,a.transceiver={receiver:i},a.streams=[r.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else T(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Re(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,u){let c=s.apply(this,arguments);return c||(c=t(this,o),this._senders.push(c)),c};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){i.apply(this,arguments);let u=this._senders.indexOf(o);u!==-1&&this._senders.splice(u,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(a=>{this._senders.push(t(this,a))})};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(a=>{let o=this._senders.find(u=>u.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Pe(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){let i=n.apply(this,[]);return i.forEach(a=>a._pc=this),i});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){let i=this;return this._pc.getStats().then(a=>ve(a,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){let s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),T(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){let s=this;return this._pc.getStats().then(i=>ve(i,s.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let r=arguments[0],s,i,a;return this.getSenders().forEach(o=>{o.track===r&&(s?a=!0:s=o)}),this.getReceivers().forEach(o=>(o.track===r&&(i?a=!0:i=o),o.track===r)),a||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function gt(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let u=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(u)===-1&&this._shimmedLocalStreams[o.id].push(u):this._shimmedLocalStreams[o.id]=[o,u],u};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(m=>m.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});let o=this.getSenders();n.apply(this,arguments);let u=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(u)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};let s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{let u=this._shimmedLocalStreams[o].indexOf(a);u!==-1&&this._shimmedLocalStreams[o].splice(u,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),s.apply(this,arguments)}}function be(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return gt(e);let n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let p=n.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(m=>this._reverseStreams[m.id])};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(m=>{if(this.getSenders().find(l=>l.track===m))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){let m=new e.MediaStream(p.getTracks());this._streams[p.id]=m,this._reverseStreams[m.id]=p,p=m}r.apply(this,[p])};let s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},e.RTCPeerConnection.prototype.addTrack=function(p,m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(y=>y===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let f=this._streams[m.id];if(f)f.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let y=new e.MediaStream([p]);this._streams[m.id]=y,this._reverseStreams[y.id]=m,this.addStream(y)}return this.getSenders().find(y=>y.track===p)};function i(c,p){let m=p.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{let l=c._reverseStreams[h],f=c._streams[l.id];m=m.replace(new RegExp(f.id,"g"),l.id)}),new RTCSessionDescription({type:p.type,sdp:m})}function a(c,p){let m=p.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{let l=c._reverseStreams[h],f=c._streams[l.id];m=m.replace(new RegExp(l.id,"g"),f.id)}),new RTCSessionDescription({type:p.type,sdp:m})}["createOffer","createAnswer"].forEach(function(c){let p=e.RTCPeerConnection.prototype[c],m={[c](){let h=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[f=>{let y=i(this,f);h[0].apply(null,[y])},f=>{h[1]&&h[1].apply(null,f)},arguments[2]]):p.apply(this,arguments).then(f=>i(this,f))}};e.RTCPeerConnection.prototype[c]=m[c]});let o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};let u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let c=u.get.apply(this);return c.type===""?c:i(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(l=>{this._streams[l].getTracks().find(y=>p.track===y)&&(h=this._streams[l])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Z(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){let r=e.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=s[n]})}function _e(e,t){T(e,"negotiationneeded",n=>{let r=n.target;if(!((t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}var re={};K(re,{shimAddTransceiver:()=>Le,shimCreateAnswer:()=>Ae,shimCreateOffer:()=>Oe,shimGetDisplayMedia:()=>yt,shimGetParameters:()=>Ie,shimGetUserMedia:()=>ee,shimOnTrack:()=>ke,shimPeerConnection:()=>te,shimRTCDataChannel:()=>Me,shimReceiverGetStats:()=>xe,shimRemoveStream:()=>De,shimSenderGetStats:()=>Ee});function ee(e,t){let n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(s,i,a){N("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,a)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){let s=function(a,o,u){o in a&&!(u in a)&&(a[u]=a[o],delete a[o])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a.audio,"autoGainControl","mozAutoGainControl"),s(a.audio,"noiseSuppression","mozNoiseSuppression")),i(a)},r&&r.prototype.getSettings){let a=r.prototype.getSettings;r.prototype.getSettings=function(){let o=a.apply(this,arguments);return s(o,"mozAutoGainControl","autoGainControl"),s(o,"mozNoiseSuppression","noiseSuppression"),o}}if(r&&r.prototype.applyConstraints){let a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o,"autoGainControl","mozAutoGainControl"),s(o,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[o])}}}}function yt(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){let s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function ke(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function te(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){let i=e.RTCPeerConnection.prototype[s],a={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=a[s]});let n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,a,o]=arguments;return r.apply(this,[i||null]).then(u=>{if(t.version<53&&!a)try{u.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;u.forEach((p,m)=>{u.set(m,Object.assign({},p,{type:n[p.type]||p.type}))})}return u}).then(a,o)}}function Ee(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let s=t.apply(this,[]);return s.forEach(i=>i._pc=this),s});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let s=n.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function xe(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=t.apply(this,[]);return r.forEach(s=>s._pc=this),r}),T(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function De(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){N("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Me(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Le(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];let s=r.length>0;s&&r.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let i=t.apply(this,arguments);if(s){let{sender:a}=i,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=r,a.sendEncodings=r,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return i})}function Ie(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Oe(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Ae(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var ne={};K(ne,{shimAudioContext:()=>$e,shimCallbacksAPI:()=>Ue,shimConstraints:()=>Ct,shimCreateOfferLegacy:()=>qe,shimGetUserMedia:()=>Fe,shimLocalStreamsAPI:()=>Ne,shimRTCIceServerUrls:()=>Ge,shimRemoteStreamsAPI:()=>je,shimTrackEventTransceiver:()=>ze});function Ne(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>t.call(this,s,r)),r.getVideoTracks().forEach(s=>t.call(this,s,r))},e.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);let r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);let s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function je(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);let i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);let a=new Event("addstream");a.stream=i,r.dispatchEvent(a)})}),t.apply(r,arguments)}}}function Ue(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,s=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(c,p){let m=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[m]);return p?(h.then(c,p),Promise.resolve()):h},t.createAnswer=function(c,p){let m=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[m]);return p?(h.then(c,p),Promise.resolve()):h};let o=function(u,c,p){let m=s.apply(this,[u]);return p?(m.then(c,p),Promise.resolve()):m};t.setLocalDescription=o,o=function(u,c,p){let m=i.apply(this,[u]);return p?(m.then(c,p),Promise.resolve()):m},t.setRemoteDescription=o,o=function(u,c,p){let m=a.apply(this,[u]);return p?(m.then(c,p),Promise.resolve()):m},t.addIceCandidate=o}function Fe(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=s=>r(Ct(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(r,s,i){t.mediaDevices.getUserMedia(r).then(s,i)}.bind(t))}function Ct(e){return e&&e.video!==void 0?Object.assign({},e,{video:Ce(e.video)}):e}function Ge(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,s){if(r&&r.iceServers){let i=[];for(let a=0;a<r.iceServers.length;a++){let o=r.iceServers[a];o.urls===void 0&&o.url?(N("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(r.iceServers[a])}r.iceServers=i}return new t(r,s)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function ze(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qe(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);let s=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);let i=this.getTransceivers().find(a=>a.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function $e(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Je={};K(Je,{removeExtmapAllowMixed:()=>oe,shimAddIceCandidateNullOrEmpty:()=>B,shimConnectionState:()=>ie,shimMaxMessageSize:()=>$,shimParameterlessSetLocalDescription:()=>J,shimRTCIceCandidate:()=>q,shimRTCIceCandidateRelayProtocol:()=>se,shimSendThrowTypeError:()=>W});var j=C(Be());function q(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){let s=new t(r),i=j.default.parseCandidate(r.candidate);for(let a in i)a in s||Object.defineProperty(s,a,{value:i[a]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,T(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function se(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||T(e,"icecandidate",t=>{if(t.candidate){let n=j.default.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function $(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});let n=function(o){if(!o||!o.sdp)return!1;let u=j.default.splitSections(o.sdp);return u.shift(),u.some(c=>{let p=j.default.parseMLine(c);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},r=function(o){let u=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;let c=parseInt(u[1],10);return c!==c?-1:c},s=function(o){let u=65536;return t.browser==="firefox"&&(t.version<57?o===-1?u=16384:u=2147483637:t.version<60?u=t.version===57?65535:65536:u=2147483637),u},i=function(o,u){let c=65536;t.browser==="firefox"&&t.version===57&&(c=65535);let p=j.default.matchPrefix(o.sdp,"a=max-message-size:");return p.length>0?c=parseInt(p[0].substring(19),10):t.browser==="firefox"&&u!==-1&&(c=2147483637),c},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){let u=r(arguments[0]),c=s(u),p=i(arguments[0],u),m;c===0&&p===0?m=Number.POSITIVE_INFINITY:c===0||p===0?m=Math.max(c,p):m=Math.min(c,p);let h={};Object.defineProperty(h,"maxMessageSize",{get(){return m}}),this._sctp=h}return a.apply(this,arguments)}}function W(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,s){let i=r.send;r.send=function(){let o=arguments[0],u=o.length||o.size||o.byteLength;if(r.readyState==="open"&&s.sctp&&u>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}let n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let s=n.apply(this,arguments);return t(s,this),s},T(e,"datachannel",r=>(t(r.channel,r.target),r))}function ie(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{let r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{let i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;let a=new Event("connectionstatechange",s);i.dispatchEvent(a)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function oe(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let i=s.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&s instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function B(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function J(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var tr=C(Be());function vt({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let n=Y,r=lt(e),s={browserDetails:r,commonShim:Je,extractVersion:z,disableLog:dt,disableWarnings:ht,sdp:tr};switch(r.browser){case"chrome":if(!w||!Z||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=w,B(e,r),J(e,r),X(e,r),Se(e,r),Z(e,r),Te(e,r),be(e,r),Re(e,r),Pe(e,r),_e(e,r),q(e,r),se(e,r),ie(e,r),$(e,r),W(e,r),oe(e,r);break;case"firefox":if(!re||!te||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=re,B(e,r),J(e,r),ee(e,r),te(e,r),ke(e,r),De(e,r),Ee(e,r),xe(e,r),Me(e,r),Le(e,r),Ie(e,r),Oe(e,r),Ae(e,r),q(e,r),ie(e,r),$(e,r),W(e,r);break;case"safari":if(!ne||!t.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=ne,B(e,r),J(e,r),Ge(e,r),qe(e,r),Ue(e,r),Ne(e,r),je(e,r),ze(e,r),Fe(e,r),$e(e,r),q(e,r),se(e,r),$(e,r),W(e,r),oe(e,r);break;default:n("Unsupported browser!");break}return s}var Mr=vt({window:typeof window>"u"?void 0:window});var ae=class extends EventTarget{constructor(){super(...arguments);this.entries=[]}addEventListener(n,r,s){return super.addEventListener(n,r,s)}removeEventListener(n,r,s){return super.removeEventListener(n,r,s)}log(n){this.entries.push(n),this.dispatchEvent(new CustomEvent("logentry"))}};var D=class{constructor(t,n,r){g(typeof t=="number","halfLifeMs is not a number"),g(!isNaN(t),"halfLifeMs can not be NaN"),g(typeof n=="number","initialValue is not a number"),g(!isNaN(n),"initialValue can not be NaN"),r!==void 0&&g(typeof r.now=="function","clock.now is not a function"),this._decay=t,this._ewma=n||0,this._clock=r||Date,this._stamp=typeof n=="number"?this._clock.now():0}insert(t){g(typeof t=="number","x is not a number"),g(!isNaN(t),"x can not be NaN");var n=this._clock.now(),r=n-this._stamp;this._stamp=n;var s=Math.pow(2,-r/this._decay);this._ewma=s*this._ewma+(1-s)*t}reset(t){g(typeof t=="number","x is not a number"),g(!isNaN(t),"x can not be NaN"),this._stamp=this._clock.now(),this._ewma=t}value(){return this._ewma}};var rr=1500,nr=1e4,St=e=>{console.debug(`%c \u{1F4DE} Calls API: ${e}`,"color: orange; background: black;")},sr=32,ce,Tt,b,M,pe,Rt,ue,Pt,me,bt,de,_t,k=class{constructor(t={}){E(this,ce);E(this,pe);E(this,ue);E(this,me);E(this,de);this.history=new ae;this.outboundPacketLossPercentageEwma=new D(1e3,0);this.inboundPacketLossPercentageEwma=new D(1e3,0);this.availableOutboundBitrate=new D(1e3,0);this.checkStats=async t=>{let n=await this.pc.getStats();await new Promise(s=>setTimeout(s,t)),(await this.pc.getStats()).forEach(s=>{if(s.type==="candidate-pair"&&"availableOutgoingBitrate"in s&&this.availableOutboundBitrate.insert(Number(s.availableOutgoingBitrate)),s.type!=="remote-inbound-rtp"&&s.type!=="inbound-rtp")return;let i=n.get(s.id);if(!i)return;let a=Math.max((s.packetsLost||0)-(i.packetsLost||0),0);if(s.type==="remote-inbound-rtp"&&s.fractionLost!==void 0){this.outboundPacketLossPercentageEwma.insert(s.fractionLost);return}let o=s.packetsReceived-i.packetsReceived;if(o>0){let u=a/o;this.inboundPacketLossPercentageEwma.insert(u)}})};this.handleIceFailure=async()=>{let{iceConnectionState:t}=this.pc;(t==="closed"||t==="failed")&&(alert("Oh no! It appears that your connection closed unexpectedly. We've copied your session id to your clipboard, and will now reload the page to reconnect!"),this.sessionId&&await navigator.clipboard.writeText(this.sessionId),window.location.reload())};var n;this.pc=new RTCPeerConnection({iceServers:(n=t.iceServers)!=null?n:[{urls:"stun:stun.cloudflare.com:3478"}],bundlePolicy:"max-bundle"}),this.transceivers=[],this.params=v(this,ce,Tt).call(this,t),this.pendingTrackTransceivers={},this.trackToMid={},this.initialization=v(this,pe,Rt).call(this),this.taskScheduler=new st,this.pushTrackDispatcher=new Q,this.pullTrackDispatcher=new Q(sr),this.closeTrackDispatcher=new Q,setInterval(()=>this.checkStats(900),1e3)}async replaceTrack(t,n){var a;console.debug(`Peer.replaceTrack: ${t} ${n.id}`);let r=t.split("/")[1],s=this.trackToMid[r];g(s,`mid for ${r} not found`);let i=(a=this.pc.getTransceivers().find(o=>o.mid===s))==null?void 0:a.sender;return g(i,`sender for ${t} not found`),this.trackToMid[n.id]=s,i.replaceTrack(n),t.replace(r,n.id)}async configureSender(t,n,r){var u,c;console.debug(`Peer.configureSender: ${t} ${n.id}`);let s=t.split("/")[1],i=this.trackToMid[s];g(i,`mid for ${s} not found`);let a=(u=this.pc.getTransceivers().find(p=>p.mid===i))==null?void 0:u.sender;g(a,`sender for ${t} not found`),this.trackToMid[n.id]=i;let o=a.getParameters();(c=r.encodings)==null||c.forEach((p,m)=>{let h=o.encodings[m];o.encodings[m]={...h,...p}}),a.setParameters(o)}async pushTrack(t,n,r){var a;console.debug(`Peer.pushTrack: ${n.kind} ${t}`),await this.initialization;let s=await this.pushTrackDispatcher.doBulkRequest({trackName:t,track:n,transceiver:v(this,ue,Pt).call(this,n,r)},async o=>await this.taskScheduler.schedule(async()=>{var p;await this.pc.setLocalDescription(await this.pc.createOffer()),g(this.pc.localDescription);let u={tracks:o.map(m=>({location:"local",mid:m.transceiver.mid,trackName:m.trackName})),sessionDescription:{sdp:this.pc.localDescription.sdp,type:"offer"}},c=await v(p=k,b,M).call(p,"POST",u,this.history,`${this.params.baseURL}/sessions/${this.sessionId}/tracks/new`,this.params.apiExtraParams);return c.errorCode||await this.pc.setRemoteDescription(new RTCSessionDescription(c.sessionDescription)),c}));if(s.errorCode)throw new Error(s.errorDescription);let i=(a=s.tracks)==null?void 0:a.find(o=>o.trackName==t);if(!i)throw new Error(`No response for trackName=${t}`);if(i.errorCode)throw new Error(`${i.errorCode}: ${i.errorDescription}`);return g(i.mid),this.trackToMid[n.id]=i.mid,{location:"remote",sessionId:this.sessionId,trackName:t}}async pullTrack(t){var u;console.debug(`Peer.pullTrack: ${t.trackName} from peer ${t.sessionId}`),await this.initialization;let{bulkResponse:n,trackPromises:r}=await this.pullTrackDispatcher.doBulkRequest(t,async c=>await this.taskScheduler.schedule(async()=>{var l;let p={tracks:c},m=await v(l=k,b,M).call(l,"POST",p,this.history,`${this.params.baseURL}/sessions/${this.sessionId}/tracks/new`,this.params.apiExtraParams);if(m.errorCode)throw new Error(m.errorDescription);g(m.tracks);let h=m.tracks.map(f=>{if(f.mid)return v(this,me,bt).call(this,f.mid)});if(m.requiresImmediateRenegotiation){await this.pc.setRemoteDescription(new RTCSessionDescription(m.sessionDescription));let f=await this.pc.createAnswer();await this.pc.setLocalDescription(f),await v(this,de,_t).call(this)}return{bulkResponse:m,trackPromises:h}})),s=(u=n.tracks)==null?void 0:u.findIndex(c=>c.sessionId==t.sessionId&&c.trackName==t.trackName);if(!n.tracks||s===void 0||s==-1)throw new Error(`No response for sessionId=${t.sessionId}, trackName=${t.trackName}`);let i=n.tracks[s];if(i.errorCode)throw new Error(`${i.errorCode}: ${i.errorDescription}`);let a=r[s];g(a),g(i.mid);let o=await a;return this.trackToMid[o.id]=i.mid,o}async closeTrack(t){var i;console.debug(`Peer.closeTrack: ${t.id}`);let n=this.trackToMid[t.id];if(!n)throw new Error("stream has no associated transceiver");await this.initialization;let s=(i=(await this.closeTrackDispatcher.doBulkRequest(n,async a=>await this.taskScheduler.schedule(async()=>{var p;this.pc.getTransceivers().filter(m=>(g(m.mid),a.includes(m.mid))).forEach(m=>m.direction="inactive"),await this.pc.setLocalDescription(await this.pc.createOffer()),g(this.pc.localDescription);let u={tracks:a.map(m=>({mid:m})),sessionDescription:{sdp:this.pc.localDescription.sdp,type:"offer"},force:!1},c=await v(p=k,b,M).call(p,"PUT",u,this.history,`${this.params.baseURL}/sessions/${this.sessionId}/tracks/close`,this.params.apiExtraParams);if(c.errorCode)throw new Error(c.errorDescription);return await this.pc.setRemoteDescription(new RTCSessionDescription(c.sessionDescription)),c}))).tracks)==null?void 0:i.find(a=>a.mid===n);if(!s)throw new Error(`No response for mid=${n}`);if(s.errorCode)throw new Error(`${s.errorCode}: ${s.errorDescription}`);delete this.trackToMid[t.id],this.transceivers=this.transceivers.filter(a=>a.mid!=n)}getDebugInfo(){return{trackToMid:this.trackToMid,commandHistoryEntries:this.history.entries,inboundPacketLossPercentage:this.inboundPacketLossPercentageEwma.value(),outboundPacketLossPercentage:this.outboundPacketLossPercentageEwma.value(),availableOutboundBitrate:this.availableOutboundBitrate.value()}}destroy(){this.pc.removeEventListener("iceconnectionstatechange",this.handleIceFailure),this.pc.close()}},U=k;ce=new WeakSet,Tt=function(t){return{iceTrickleEnabled:!1,baseURL:"/api/calls",onDisconnect:()=>{},onConnect:()=>{},...t}},b=new WeakSet,M=async function(t,n,r,s,i="",a=2){var p;let o=new URL(s,window.location.origin);[...new URLSearchParams(i).entries()].forEach(([m,h])=>{o.searchParams.append(m,h)});let c={method:t,mode:"cors",redirect:"manual",headers:{"content-type":"application/json"},body:JSON.stringify(n)};St("Sending Calls request:"),console.debug(c.method,s),console.debug(c);try{r.log({type:"request",endpoint:s,body:n});let m=await fetch(o,c);m.status===0&&(alert("Access session is expired, reloading page."),location.reload());let h=await m.json();return r.log({type:"response",endpoint:s,body:h}),h}catch(m){if(a===0)throw m;return console.error("Calls request failed, retrying..."),v(p=k,b,M).call(p,t,n,r,s,i,a-1)}},pe=new WeakSet,Rt=async function(){var s;this.transceivers.push(this.pc.addTransceiver("audio",{direction:"inactive"})),this.pc.setLocalDescription(await this.pc.createOffer()),this.pc.addEventListener("iceconnectionstatechange",this.handleIceFailure),this.pc.ontrack=i=>{if(i.transceiver.mid===null)return;let a=this.pendingTrackTransceivers[i.transceiver.mid];a?(delete this.pendingTrackTransceivers[i.transceiver.mid],a(i.track)):console.warn("No pending track for transceiver",i.transceiver)};let t=new Promise((i,a)=>{this.pc.addEventListener("connectionstatechange",()=>{this.pc.connectionState=="connected"&&i(!0)})}),n=new Promise((i,a)=>{setTimeout(()=>i(!0),rr),this.params.iceTrickleEnabled&&this.pc.addEventListener("icecandidate",o=>{i(!0)}),this.pc.onicegatheringstatechange=o=>{this.pc.iceGatheringState==="complete"&&i(!0)}});this.pc.addEventListener("connectionstatechange",i=>{switch(this.pc.connectionState){case"connected":this.params.onConnect(this.pc.connectionState,i);break;case"failed":case"disconnected":this.params.onDisconnect(this.pc.connectionState,i)}}),await n,g(this.pc.localDescription),St("Sending initial offer");let r=await v(s=k,b,M).call(s,"POST",{sessionDescription:{type:"offer",sdp:this.pc.localDescription.sdp}},this.history,`${this.params.baseURL}/sessions/new`,this.params.apiExtraParams);if(r.errorCode)throw new Error(r.errorDescription);this.sessionId=r.sessionId,await this.pc.setRemoteDescription(new RTCSessionDescription(r.sessionDescription)),await t},ue=new WeakSet,Pt=function(t,n){let r=this.pc.addTransceiver(t,{direction:"sendonly",sendEncodings:n});return this.transceivers.push(r),r},me=new WeakSet,bt=function(t){return new Promise((n,r)=>{setTimeout(r,nr,"track resolving timed out"),this.pendingTrackTransceivers[t]=s=>n(s)})},de=new WeakSet,_t=async function(){var r;g(this.pc.currentLocalDescription);let t={sessionDescription:{sdp:this.pc.currentLocalDescription.sdp,type:"answer"}},n=await v(r=k,b,M).call(r,"PUT",t,this.history,`${this.params.baseURL}/sessions/${this.sessionId}/renegotiate`,this.params.apiExtraParams);if(n.errorCode)throw new Error(n.errorDescription)},E(U,b);var kt=C(P());function Et(e){let t=JSON.stringify(e);return(0,kt.useMemo)(()=>JSON.parse(t),[t])}var xt=e=>{let[t,n]=(0,F.useState)(null),[r,s]=(0,F.useState)(),[i,a]=(0,F.useState)("new"),o=Et(e);return(0,F.useEffect)(()=>{let u=new U(o);n(u);let c=()=>{s(u.getDebugInfo())},p=()=>{a(u.pc.iceConnectionState)};return u.pc.addEventListener("iceconnectionstatechange",p),u.history.addEventListener("logentry",c),()=>{u.history.removeEventListener("logentry",c),u.pc.removeEventListener("connectionstatechange",p),u.destroy()}},[o]),{peer:t,debugInfo:r,iceConnectionState:i}};var G=C(P());function V(e,t,{priority:n,maxBitrate:r,maxFramerate:s,scaleResolutionDownBy:i}={}){let[a,o]=(0,G.useState)(),[u,c]=(0,G.useState)(!1);return(0,G.useEffect)(()=>{u||!e||!t||(a===void 0?(c(!0),nt(()=>e.pushTrack(t.id,t).then(p=>{let m=`${p.sessionId}/${p.trackName}`;o(m),c(!1)}))):e.replaceTrack(a,t))},[t,e,u,a]),(0,G.useEffect)(()=>{if(!t||!a||!e)return;let p=[{maxBitrate:r,maxFramerate:s,priority:n,scaleResolutionDownBy:i}];e.configureSender(a,t,{encodings:p})},[r,s,t,e,n,i,a]),a}var O=C(P());function Ve(e,t="Unhandled type: assert never failed"){throw new Error(t)}(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can polyfill this global by adding this to your code before any partysocket imports: 
  
  \`\`\`
  import 'partysocket/event-target-polyfill';
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var Mt=class extends Event{message;error;constructor(e,t){super("error",t),this.message=e.message,this.error=e}},Lt=class extends Event{code;reason;wasClean=!0;constructor(e=1e3,t="",n){super("close",n),this.code=e,this.reason=t}},Ke={Event,ErrorEvent:Mt,CloseEvent:Lt};function ir(e,t){if(!e)throw new Error(t)}function or(e){return new e.constructor(e.type,e)}function ar(e){return"data"in e?new MessageEvent(e.type,e):"code"in e||"reason"in e?new Lt(e.code||1999,e.reason||"unknown reason",e):"error"in e?new Mt(e.error,e):new Event(e.type,e)}var cr=typeof process<"u"&&typeof process.versions?.node<"u"&&typeof document>"u",he=cr?ar:or,L={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},Dt=!1,He=class I extends EventTarget{_ws;_retryCount=-1;_uptimeTimeout;_connectTimeout;_shouldReconnect=!0;_connectLock=!1;_binaryType="blob";_closeCalled=!1;_messageQueue=[];_debugLogger=console.log.bind(console);_url;_protocols;_options;constructor(t,n,r={}){super(),this._url=t,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return I.CONNECTING}get OPEN(){return I.OPEN}get CLOSING(){return I.CLOSING}get CLOSED(){return I.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((n,r)=>(typeof r=="string"?n+=r.length:r instanceof Blob?n+=r.size:n+=r.byteLength,n),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?I.CLOSED:I.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}onclose=null;onerror=null;onmessage=null;onopen=null;close(t=1e3,n){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,n)}reconnect(t,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,n),this._connect())}send(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{let{maxEnqueuedMessages:n=L.maxEnqueuedMessages}=this._options;this._messageQueue.length<n&&(this._debug("enqueue",t),this._messageQueue.push(t))}}_debug(...t){this._options.debug&&this._debugLogger("RWS>",...t)}_getNextDelay(){let{reconnectionDelayGrowFactor:t=L.reconnectionDelayGrowFactor,minReconnectionDelay:n=L.minReconnectionDelay,maxReconnectionDelay:r=L.maxReconnectionDelay}=this._options,s=0;return this._retryCount>0&&(s=n*Math.pow(t,this._retryCount-1),s>r&&(s=r)),this._debug("next delay",s),s}_wait(){return new Promise(t=>{setTimeout(t,this._getNextDelay())})}_getNextProtocols(t){if(!t)return Promise.resolve(null);if(typeof t=="string"||Array.isArray(t))return Promise.resolve(t);if(typeof t=="function"){let n=t();if(!n)return Promise.resolve(null);if(typeof n=="string"||Array.isArray(n))return Promise.resolve(n);if(n.then)return n}throw Error("Invalid protocols")}_getNextUrl(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){let n=t();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;let{maxRetries:t=L.maxRetries,connectionTimeout:n=L.connectionTimeout}=this._options;if(this._retryCount>=t){this._debug("max retries reached",this._retryCount,">=",t);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([r,s])=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!Dt&&(console.error(`\u203C\uFE0F No WebSocket implementation available. You should define options.WebSocket. 

For example, if you're using node.js, run \`npm install ws\`, and then in your code:

import PartySocket from 'partysocket';
import WS from 'ws';

const partysocket = new PartySocket({
  host: "127.0.0.1:1999",
  room: "test-room",
  WebSocket: WS
});

`),Dt=!0);let i=this._options.WebSocket||WebSocket;this._debug("connect",{url:r,protocols:s}),this._ws=s?new i(r,s):new i(r),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),n)}).catch(r=>{this._connectLock=!1,this._handleError(new Ke.ErrorEvent(Error(r.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new Ke.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(t=1e3,n){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(t,n),this._handleClose(new Ke.CloseEvent(t,n,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_handleOpen=t=>{this._debug("open event");let{minUptime:n=L.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),ir(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(r=>this._ws?.send(r)),this._messageQueue=[],this.onopen&&this.onopen(t),this.dispatchEvent(he(t))};_handleMessage=t=>{this._debug("message event"),this.onmessage&&this.onmessage(t),this.dispatchEvent(he(t))};_handleError=t=>{this._debug("error event",t.message),this._disconnect(void 0,t.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(t),this._debug("exec error listeners"),this.dispatchEvent(he(t)),this._connect()};_handleClose=t=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(t),this.dispatchEvent(he(t))};_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};var pr=e=>e[1]!==null&&e[1]!==void 0;function ur(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();let e=new Date().getTime(),t=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let r=Math.random()*16;return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),(n==="x"?r:r&3|8).toString(16)})}function Ot(e,t,n={}){let{host:r,path:s,protocol:i,room:a,party:o,query:u}=e,c=r.replace(/^(http|https|ws|wss):\/\//,"");if(c.endsWith("/")&&(c=c.slice(0,-1)),s&&s.startsWith("/"))throw new Error("path must not start with a slash");let p=o??"main",m=s?`/${s}`:"",h=i||(c.startsWith("localhost:")||c.startsWith("127.0.0.1:")||c.startsWith("192.168.")||c.startsWith("10.")||c.startsWith("172.")&&c.split(".")[1]>="16"&&c.split(".")[1]<="31"||c.startsWith("[::ffff:7f00:1]:")?t:t+"s"),l=`${h}://${c}/${o?`parties/${o}`:"party"}/${a}${m}`,f=(ge={})=>`${l}?${new URLSearchParams([...Object.entries(n),...Object.entries(ge).filter(pr)])}`,y=typeof u=="function"?async()=>f(await u()):f(u);return{host:c,path:m,room:a,name:p,protocol:h,partyUrl:l,urlProvider:y}}var At=class extends He{constructor(e){let t=It(e);super(t.urlProvider,t.protocols,t.socketOptions),this.partySocketOptions=e,this.setWSProperties(t)}_pk;_pkurl;name;room;host;path;updateProperties(e){let t=It({...this.partySocketOptions,...e,host:e.host??this.host,room:e.room??this.room,path:e.path??this.path});this._url=t.urlProvider,this._protocols=t.protocols,this._options=t.socketOptions,this.setWSProperties(t)}setWSProperties(e){let{_pk:t,_pkurl:n,name:r,room:s,host:i,path:a}=e;this._pk=t,this._pkurl=n,this.name=r,this.room=s,this.host=i,this.path=a}reconnect(e,t){if(!this.room||!this.host)throw new Error("The room and host must be set before connecting, use `updateProperties` method to set them or pass them to the constructor.");super.reconnect(e,t)}get id(){return this._pk}get roomUrl(){return this._pkurl}static async fetch(e,t){let n=Ot(e,"http"),r=typeof n.urlProvider=="string"?n.urlProvider:await n.urlProvider();return(e.fetch??fetch)(r,t)}};function It(e){let{id:t,host:n,path:r,party:s,room:i,protocol:a,query:o,protocols:u,...c}=e,p=t||ur(),m=Ot(e,"ws",{_pk:p});return{_pk:p,_pkurl:m.partyUrl,name:m.name,room:m.room,host:m.host,path:m.path,protocols:u,socketOptions:c,urlProvider:m.urlProvider}}var le=C(P(),1),_=C(P(),1),Nt=(e,t)=>{let n=(0,le.useRef)(t);n.current=t,(0,le.useEffect)(()=>{let r=o=>n.current?.onOpen?.(o),s=o=>n.current?.onMessage?.(o),i=o=>n.current?.onClose?.(o),a=o=>n.current?.onError?.(o);return e.addEventListener("open",r),e.addEventListener("close",i),e.addEventListener("error",a),e.addEventListener("message",s),()=>{e.removeEventListener("open",r),e.removeEventListener("close",i),e.removeEventListener("error",a),e.removeEventListener("message",s)}},[e])},jt=e=>[e.startClosed,e.minUptime,e.maxRetries,e.connectionTimeout,e.maxEnqueuedMessages,e.maxReconnectionDelay,e.minReconnectionDelay,e.reconnectionDelayGrowFactor,e.debug];function Ut({options:e,createSocket:t,createSocketMemoKey:n}){let r=n(e),s=(0,_.useMemo)(()=>e,[r]),[i,a]=(0,_.useState)(()=>t({...s,startClosed:!0})),o=(0,_.useRef)(null),u=(0,_.useRef)(t);return u.current=t,(0,_.useEffect)(()=>{if(o.current===i){let c=u.current({...s,startClosed:!1});a(c)}else return!o.current&&s.startClosed!==!0&&i.reconnect(),o.current=i,()=>{i.close()}},[i,s]),i}function Ft(e){let{host:t,...n}=e,r=Ut({options:{host:t||(typeof window<"u"?window.location.host:"dummy-domain.com"),...n},createSocket:s=>new At(s),createSocketMemoKey:s=>JSON.stringify([s.query,s.id,s.host,s.room,s.party,s.path,s.protocol,s.protocols,...jt(s)])});return Nt(r,e),r}function Qe({roomName:e,userMedia:t}){let[n,r]=(0,O.useState)({users:[]}),s=Ft({party:"rooms",room:e,onMessage:o=>{let u=JSON.parse(o.data);switch(u.type){case"roomState":if(JSON.stringify(u.state)===JSON.stringify(n))break;r(u.state);break;case"error":console.error("Received error message from WebSocket"),console.error(u.error);break;case"directMessage":break;case"muteMic":t.turnMicOff();break;case"partyserver-pong":break;default:Ve(u);break}}});(0,O.useEffect)(()=>{let o=setInterval(()=>{s.send(JSON.stringify({type:"partyserver-ping"}))},1e4);return()=>clearInterval(o)},[s]);let i=(0,O.useMemo)(()=>n.users.find(o=>o.id===s.id),[n.users,s.id]),a=(0,O.useMemo)(()=>n.users.filter(o=>o.id!==s.id&&o.joined),[n.users,s.id]);return{identity:i,otherUsers:a,websocket:s,roomState:n}}var dr=C(zt()),R=C(H());function qt(){return(0,R.jsx)(ct,{children:(0,R.jsx)(at,{fallback:(0,R.jsx)("div",{className:"grid h-full place-items-center",children:(0,R.jsx)("div",{children:(0,R.jsxs)("h1",{className:"flex items-center gap-3 text-3xl font-black",children:[(0,R.jsx)(rt,{type:"SignalSlashIcon"}),"You are offline"]})})}),children:(0,R.jsx)(lr,{})})})}function hr(e){var r,s,i,a;if(e===void 0||e.getCapabilities===void 0)return{height:0,width:0};let t=(s=(r=e==null?void 0:e.getCapabilities().height)==null?void 0:r.max)!=null?s:0,n=(a=(i=e==null?void 0:e.getCapabilities().width)==null?void 0:i.max)!=null?a:0;return{height:t,width:n}}function lr(){let[e,t]=(0,fe.useState)(!1),{roomName:n}=Xe();g(n);let{mode:r,userDirectoryUrl:s,traceLink:i,feedbackEnabled:a,apiExtraParams:o,iceServers:u,maxWebcamBitrate:c=12e5,maxWebcamFramerate:p=24,maxWebcamQualityLevel:m=1080}=we(),h=tt(r),l=Qe({roomName:n,userMedia:h}),{peer:f,debugInfo:y,iceConnectionState:ge}=xt({apiExtraParams:o,iceServers:u}),$t=(0,fe.useMemo)(()=>{let Vt=h.videoStreamTrack,{height:Kt,width:Ht}=hr(Vt),Qt=Math.min(Kt,Ht);return Math.max(Qt/m,1)},[m,h.videoStreamTrack]),Wt=V(f,h.videoStreamTrack,{maxFramerate:p,maxBitrate:c,scaleResolutionDownBy:$t}),Bt=V(f,h.audioStreamTrack,{priority:"high"}),Jt=V(f,h.screenShareVideoTrack);return(0,R.jsx)(Ze,{context:{joined:e,setJoined:t,traceLink:i,userMedia:h,userDirectoryUrl:s,feedbackEnabled:a,peer:f,peerDebugInfo:y,iceConnectionState:ge,room:l,pushedTracks:{video:Wt,audio:Bt,screenshare:Jt}}})}export{qt as default};
/*! Bundled license information:

partysocket/dist/chunk-KZ3GGBVP.mjs:
  (*!
   * Reconnecting WebSocket
   * by Pedro Ladaria <pedro.ladaria@gmail.com>
   * https://github.com/pladaria/reconnecting-websocket
   * License MIT
   *)
*/
//# sourceMappingURL=/build/routes/_room-3WYFQBMF.js.map
